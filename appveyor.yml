image: macOS

environment:
  RUSTUP_HOME: /usr/local/rustup
  CARGO_HOME: /usr/local/cargo
  RUST_VERSION: '1.43.0'

build_script:
  - export PATH="/usr/local/cargo/bin:$PATH"
  - curl https://static.rust-lang.org/rustup/archive/1.21.1/x86_64-apple-darwin/rustup-init -o rustup-init
  - chmod +x rustup-init
  - RUSTUP_HOME="/usr/local/rustup" CARGO_HOME="/usr/local/cargo" sudo ./rustup-init -y --profile minimal --default-toolchain $RUST_VERSION
  - rm rustup-init
  - chmod -R a+w $RUSTUP_HOME $CARGO_HOME
  - rustup --version
  - cargo --version
  - rustc --version
  - python ./tools/build.py build --debug
  - python ./tools/build.py build
  - cargo build
  - cargo build --release

artifacts:
  - path: out/x86_64-apple-darwin
    type: zip
